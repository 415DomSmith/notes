# RSpec Testing

* <h3> TDD - Test Driven Development</h3>

# Student Learning Objectives:

* <h3> By the end of this lesson you should be able to:</h3>

	* <h3> 1) Set up an rspec testing environment for a ruby project</h3>

	* <h3> 2) Write basic describe/it blocks to test an existing Class</h3>
	
	* <h3> 3) Go through Red/Green/Refactor routine to create a Class with tests</h3>
	
## Why do we write tests

* <h3> Helps you organize your thoughts to understand the problem or feature you are trying to code. </h3>

* <h3> Go back to edit your program after a period of time, you can review the tests to see how the program is supposed to work. </h3>

* <h3> You can refactor you code with some degree of assuance that your program still works. </h3>

* <h3> For every new edit you want to release, you don't want to have to test all the buttons and links in you web site.</h3>

* <h3> On a project team, you could write code that could break someone else's code.</h3>
	
* <h3> On a project team, someone else could write code that could break your code.</h3>
	
	
## Test Driven Development Flow:

### Mantra: Red, Green, Refactor

*  <h3> "Red" => write test, run test, test fails</h3>
*  <h3>"Green" => write just enough code to make it pass</h3>
*  <h3> "Refactor" => look for ways to improve your code</h3>



# 1) Setup rspec test environment:

## Installation
	$ gem install rspec
	$ rspec --v
	$ rspec --help

### Go to your working folder for todays lesson
	$ rspec --init
		create spec/spec_helper.rb
		create .rspec
 

* <h3> rspec --init created:</h3>
	* <h3> a spec folder with the spec_helper.rb file in it</h3>	
	* <h3> a .rspec file that is for your configuration </h3>

### Edit .rspec ( use: "ls -la" to see the hidden files)

#### Open .rspec and add the lines:
	--color
	--format documentation

	
### Review spec_helper.rb

* <h3> spec_helper.rb makes the RSpec tests are run in a random order.</h3>
	* <h3> put all your tests in the spec folder.</h3> 
* <h3>Beware of dependencies, tests should be indepentent.</h3>

		$ cd spec
		$ cat spec_helper.rb


* <h3>spec_helper.rb:</h3>

		# This file was generated by the `rspec --init` command. Conventionally, all
		# specs live under a `spec` directory, which RSpec adds to the `$LOAD_PATH`.
		# Require this file using `require "spec_helper"` to ensure that it is only
		# loaded once.
		#
		# See http://rubydoc.info/gems/rspec-core/RSpec/Core/Configuration
		RSpec.configure do |config|
			config.treat_symbols_as_metadata_keys_with_true_values = true
			config.run_all_when_everything_filtered = true
			config.filter_run :focus

			# Run specs in random order to surface order dependencies. If you find an
			# order dependency and want to debug it, you can fix the order by providing
			# the seed, which is printed after each run.
			#     --seed 1234
			config.order = 'random'
		end


#2) Write basic describe/it blocks to test an existing Class 

## RSpec Testing Syntax Structure:
*  <h3> describe blocks</h3>
*  <h3> context block (optional)</h3> 
*  <h3> it blocks</h3>


#### Sample code

	describe Square do
	  it "has a side attribute" do
	    test code
	  end

	  it "has an area method" do
	    test code
	  end
	end

## Special blocks: Before & After
* <h3> Due to the random order of tests, you can't rely on the conditions of one test to setting up the other. </h3>
* <h3> Eliminate the "order dependencies".</h3>
* <h3> Before block runs before each test</h3>
	* <h4> before(:all), before(:each)</h4> 
	
			before(:each) do  
    			@my_square = Square.new(5)
    		end
    	
    	 
* <h3> After block runs after each test</h3>
	* <h4> after(:all), after(:each)</h4> 

			after(:each) do  
    			@my_square = nil
    		end

## Exercise 1: Write some describe / it tests for an existing class.
#### 1) Go to your notes directory and pull the latest notes
	$> git pull
#### 2) Go to the notes/rspec
	> cd rspec
#### 3) Copy the lab directory to my_lab directory
	> cp -r lab my_lab
#### 4)Go to the my_lab directory
	> cd my_lab
#### 5) Run the first test: rspec spec/square_spec.rb
	if this passes we can proceed


### Assignment: We have a Square class in square.rb. We need to write tests in spec/square_spec.rb that tests square.rb. We will do this together.

## square.rb

	class Square
		attr_accessor :side
		
		def initialize(side)
    		@side = side
    	end
    	
    	def area
    		@side ** 2
    	end
    	
    	def perimeter
    		@side * 4
    	end
    	
    	def to_s
    		"I am a square. My sides are of length: #{@side}. My area is: #{self.area}, and my perimeter is: #{self.perimeter}"
    	end
    end


## square_spec.rb

	require './square'
	require 'spec_helper'
	
	describe Square do  
	
		before(:each) do  
    		@my_square = Square.new(5)
    	end
    
    	it "should have a side" do
    	    my_square = Square.new(5)
    		# @my_square.side.should eq(5)
    		expect(@my_square.side).to eq(5)
    	end

    end
    
# 3) Go through Red/Green/Refactor routine to create a Class with tests
### Remember our mantra: Red, Green, Refactor

*  <h3> "Red" => write test, run test, test fails</h3>
*  <h3>"Green" => write just enough code to make it pass</h3>
*  <h3> "Refactor" => look for ways to improve your code</h3>


## Exercise 2: 
### Setup:
#### 1) Run spec/employee_spec.rb
	if this passes we can proceed
### Assignment	
#### 1) Create a list of attributes and methods that our Employee class should have.
#### 2) Create a list of tests for the attributes and methods.
#### 3) Add one of the tests into spec/employee_spec.rb
#### 4) Run the test, it should fail (i.e."Red").
#### 5) Add code to your employee.rb file until that test passes (i.e. "Green").
#### 6) Return to step 3 until all tests are coded

#### employee_spec.rb:

	require './employee'
	require 'spec_helper'

	describe Employee do
      
      before(:each) do
	    @employee = Employee.new("YourName")
      end

	  it "has a name " do
	  	@employee.name.should eq("YourName")
	  end
	  
	  it "can change the name" do
	    @employee.name = "NewName"
	    @employee.name.should eq("YourName")
	  end
	  
	end

#### employee.rb

	class Employee
	  attr_accessor :name

	  def initialize(name)
		@name = name
	  end

	end
	
#@@@@@@@@@@@@@@@@@@
##[Rspec Documentation "Relish"](https://relishapp.com/rspec/)
##[Rspec expectations doc](http://rubydoc.info/gems/rspec-expectations/frames)
##[Better Specs - Rspec guidelines](http://betterspecs.org/)

## Other "expectations":

* <h3> ".should != 5" is same as _".should_not eq(5)"_ </h3>
	* <h3> expect(some_operation).not_to eq(5)</h3> 
* <h3> ".should == true" is same as _".should  be_true"_ </h3>
	* <h3> expect(some_operation).to be_true</h3>  
* <h3> ".should == false" is same as _".should  be_false"_ </h3>
	* <h3> expect(some_operation).to be_false</h3>  
* <h3> ".should < 5" is same as _".should be < 5"_ </h3>
	* <h3> expect(some_operation).to be < 5</h3>  
	


	







